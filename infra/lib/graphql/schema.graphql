# GraphQL schema for Neighborly API

type Building @aws_api_key @aws_cognito_user_pools {
  buildingId: ID!
  address: String!
  name: String
  country: String!
  state: String!
  city: String!
  memberCount: Int!
  createdTime: AWSDateTime!
}

type Channel @aws_api_key @aws_cognito_user_pools {
  channelId: ID!
  buildingId: ID!
  name: String!
  description: String
  createdTime: AWSDateTime!
}

type Message @aws_api_key @aws_cognito_user_pools {
  messageId: ID!
  channelId: ID!
  userId: ID!
  content: String!
  mediaUrl: String
  sentTime: AWSDateTime!
}

type User @aws_api_key @aws_cognito_user_pools {
  userId: ID!
  email: AWSEmail!
  username: String
  joinedBuildings: [ID!]
  createdTime: AWSDateTime!
}

type Query {
  getBuilding(buildingId: ID!): Building @aws_api_key @aws_cognito_user_pools
  searchBuildings(
    city: String!
    state: String!
    addressFilter: String
  ): [Building!] @aws_api_key @aws_cognito_user_pools
  listChannels(buildingId: ID!): [Channel!] @aws_api_key @aws_cognito_user_pools
  listMessages(
    channelId: ID!
    limit: Int
    nextToken: String
  ): MessageConnection @aws_api_key @aws_cognito_user_pools
  getUser(userId: ID!): User @aws_api_key @aws_cognito_user_pools
  getUsersByIds(userIds: [ID!]!): [User] @aws_api_key @aws_cognito_user_pools
}

type MessageConnection @aws_api_key @aws_cognito_user_pools {
  items: [Message!]
  nextToken: String
}

type Mutation {
  joinBuilding(buildingId: ID!): Building @aws_api_key @aws_cognito_user_pools
  createChannel(buildingId: ID!, name: String!, description: String): Channel
    @aws_api_key
    @aws_cognito_user_pools
  createMessage(channelId: ID!, content: String!, mediaUrl: String): Message
    @aws_api_key
    @aws_cognito_user_pools
  updateLastRead(channelId: ID!, lastReadTime: AWSDateTime!): Boolean
    @aws_api_key
    @aws_cognito_user_pools
}

type Subscription {
  onMessageCreated(channelId: ID!): Message
    @aws_subscribe(mutations: ["createMessage"])
}

schema {
  query: Query
  mutation: Mutation
  subscription: Subscription
}
